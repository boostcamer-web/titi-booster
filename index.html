<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titi Booster Flight - Version Sonorisée</title>
    <style>
        body { margin: 0; padding: 0; background: #000; overflow: hidden; display: flex; flex-direction: column; min-height: 100vh; font-family: sans-serif; }
        .game-header { background: rgba(0, 0, 0, 0.8); padding: 10px; color: white; text-align: center; z-index: 10; }
        #gameContainer { flex: 1; display: flex; justify-content: center; align-items: center; }
        canvas { display: block; max-width: 100vw; max-height: 80vh; }
    </style>
</head>
<body>
    <div class="game-header">
        <h1 style="margin:0; font-size: 18px;">Titi Booster Flight</h1>
        <p style="margin:5px 0 0; font-size: 12px;">Cliquez pour voler - Atteignez 1000 points pour le BONUS !</p>
    </div>
    <div id="gameContainer"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.3/pixi.min.js"></script>
    
    <script type="module">
        // CONFIGURATION DES ASSETS
        const __ASSET_MAP__ = {
            "titi_player": { "url": "https://storage.googleapis.com/scraper_ludo/user_images_prod/75818ca0223a6d74cd1d3d4b2794bb6d.png" },
            "sky_background": { "url": "https://storage.googleapis.com/scraper_ludo/user_images_prod/4e8126247acdc48a2cc3d9de1c355c40.png" },
            "instagram_like": { "url": "https://storage.googleapis.com/scraper_ludo/user_images_prod/41561b59787ec16571c3f2bc32279d79.png" },
            "tiktok_star": { "url": "https://storage.googleapis.com/scraper_ludo/user_images_prod/da26053eade54abfb80d5e9e6b9448a5.png" },
            "shadowban_cloud": { "url": "https://storage.googleapis.com/scraper_ludo/user_images_prod/a92c4af60a1cdb4229a3676ca00e3746.png" },
            "bot_enemy": { "url": "https://storage.googleapis.com/scraper_ludo/user_images_prod/67dd4ee7eec1196a4313b55574ad1653.png" }
        };

        const app = new PIXI.Application({ width: 800, height: 600, backgroundColor: 0x1099bb });
        document.getElementById('gameContainer').appendChild(app.view);

        class Game {
            constructor() {
                this.score = 0;
                this.isGameOver = false;
                this.collectibles = [];
                this.obstacles = [];
                
                // --- AJOUT DES SONS ---
                this.sndJump = new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_502394595a.mp3");
                this.sndCollect = new Audio("https://cdn.pixabay.com/audio/2022/03/10/audio_c3508a28fe.mp3");
                this.sndHit = new Audio("https://cdn.pixabay.com/audio/2021/08/09/audio_039644d621.mp3");
                this.sndWin = new Audio("https://cdn.pixabay.com/audio/2021/08/04/audio_bb647fdcc4.mp3");
            }

            setup() {
                this.container = new PIXI.Container();
                app.stage.addChild(this.container);

                this.bg = new PIXI.TilingSprite(PIXI.Texture.from(__ASSET_MAP__.sky_background.url), 1600, 600);
                this.container.addChild(this.bg);

                this.player = PIXI.Sprite.from(__ASSET_MAP__.titi_player.url);
                this.player.anchor.set(0.5);
                this.player.height = 80;
                this.player.width = 110;
                this.player.x = 100;
                this.player.y = 300;
                this.player.velocity = 0;
                this.container.addChild(this.player);

                this.scoreText = new PIXI.Text('Score: 0', { fill: 0xffffff, fontSize: 30, fontWeight: 'bold' });
                this.scoreText.x = 20; this.scoreText.y = 20;
                app.stage.addChild(this.scoreText);

                app.stage.eventMode = 'static';
                app.stage.on('pointerdown', () => {
                    if(!this.isGameOver) {
                        this.player.velocity = -8;
                        this.sndJump.currentTime = 0;
                        this.sndJump.play(); // Son de propulsion
                    }
                });

                this.spawnTimer = 0;
            }

            update(delta) {
                if (this.isGameOver) return;

                // Gravité et mouvement
                this.player.velocity += 0.4;
                this.player.y += this.player.velocity;
                this.bg.tilePosition.x -= 3;

                // Limites écran
                if (this.player.y > 600 || this.player.y < 0) this.gameOver();

                // Spawn objets
                this.spawnTimer++;
                if (this.spawnTimer > 60) {
                    this.createObject();
                    this.spawnTimer = 0;
                }

                // Collisions Collectibles
                this.collectibles.forEach((c, i) => {
                    c.x -= 5;
                    if (this.rectIntersect(this.player, c)) {
                        this.score += 20;
                        this.sndCollect.currentTime = 0;
                        this.sndCollect.play(); // Son de capture
                        this.container.removeChild(c);
                        this.collectibles.splice(i, 1);
                    }
                });

                // Collisions Obstacles
                this.obstacles.forEach((o, i) => {
                    o.x -= 6;
                    if (this.rectIntersect(this.player, o)) {
                        this.shakeScreen(); // EFFET SPÉCIAL : Tremblement
                        this.sndHit.play(); // Son de collision
                        this.gameOver();
                    }
                });

                this.scoreText.text = `Score: ${this.score}`;
                if (this.score >= 1000) this.win();
            }

            createObject() {
                const isObstacle = Math.random() > 0.6;
                const tex = isObstacle ? __ASSET_MAP__.shadowban_cloud.url : __ASSET_MAP__.instagram_like.url;
                const sprite = PIXI.Sprite.from(tex);
                sprite.anchor.set(0.5);
                sprite.x = 850;
                sprite.y = Math.random() * 500 + 50;
                sprite.height = 50; sprite.width = 50;
                this.container.addChild(sprite);
                if (isObstacle) this.obstacles.push(sprite);
                else this.collectibles.push(sprite);
            }

            rectIntersect(a, b) {
                const ab = a.getBounds(); const bb = b.getBounds();
                return ab.x + ab.width > bb.x && ab.x < bb.x + bb.width && ab.y + ab.height > bb.y && ab.y < bb.y + bb.height;
            }

            shakeScreen() {
                const intensity = 10;
                this.container.x = Math.random() * intensity - intensity/2;
                setTimeout(() => this.container.x = 0, 100);
            }

            gameOver() {
                this.isGameOver = true;
                alert("Game Over! Score: " + this.score);
                location.reload();
            }

            win() {
                this.isGameOver = true;
                this.sndWin.play(); // Musique de victoire
                const code = "TITI-BOOST-" + Math.floor(Math.random()*999);
                alert("BRAVO ! Titi a boosté ton compte.\nTon code promo : " + code);
                window.location.href = "https://theboostconcept.com";
            }
        }

        // Chargement et démarrage
        const game = new Game();
        PIXI.Assets.load(Object.values(__ASSET_MAP__).map(a => a.url)).then(() => {
            game.setup();
            app.ticker.add((delta) => game.update(delta));
        });
    </script>
</body>
</html>
